<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Staff - Proyecto Paisa Roleplay</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <h1>Panel Staff</h1>
    <nav>
      <a href="index.html">Inicio</a>
      <a href="normativas.html">Normativas</a>
      <a href="reportar.html">Reportar</a>
      <a href="panel.html">Panel Staff</a>
    </nav>
  </header>

  <main>
    <section>
      <h2>Reportes Asignados</h2>
      <div id="reportes-list">
        <p>Cargando reportes...</p>
      </div>
    </section>
  </main>

  <footer>
    <p>© 2026 Proyecto Paisa Roleplay – Todos los derechos reservados</p>
  </footer>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://wgimbwzhxwxmcneekuen.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnaW1id3poeHd4bWNuZWVrdWVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1ODk2NjEsImV4cCI6MjA4MzE2NTY2MX0.79xbkg9rhDdIZoThUvB5IMpT0rqXag1wjzNmoSvR62E'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const reportesList = document.getElementById('reportes-list')

    const fetchReportes = async () => {
      try {
        // Traer reportes
        const { data: reportes, error: reportesError } = await supabase
          .from('reportes')
          .select('*')
          .order('fecha', { ascending: false })

        if (reportesError) throw reportesError

        if (!reportes || reportes.length === 0) {
          reportesList.innerHTML = '<p>No hay reportes por mostrar.</p>'
          return
        }

        // Traer todas las sanciones para mapear los IDs a nombre+tiempo
        const { data: sancionesData, error: sancionesError } = await supabase.from('sanciones').select('*')
        if (sancionesError) throw sancionesError

        const sancionesMap = {}
        sancionesData.forEach(s => {
          sancionesMap[s.id] = `${s.categoria} - ${s.regla} (${s.tiempo})`
        })

        // Mostrar reportes
        reportesList.innerHTML = reportes.map(r => {
          let sancionesTexto = ''
          if (r.sanciones && Array.isArray(r.sanciones)) {
            sancionesTexto = r.sanciones.map(id => sancionesMap[id] || id).join(', ')
          }

          return `
            <div class="reporte">
              <p><strong>Usuario que reporta:</strong> ${r.reportante || 'N/A'}</p>
              <p><strong>Usuario reportado:</strong> ${r.usuario_reportado}</p>
              <p><strong>Motivo:</strong> ${r.motivo}</p>
              <p><strong>Contexto:</strong> ${r.contexto || 'N/A'}</p>
              <p><strong>Descripción:</strong> ${r.descripcion}</p>
              <p><strong>Evidencia:</strong> ${r.evidencia || 'N/A'}</p>
              <p><strong>Sanciones:</strong> ${sancionesTexto || 'N/A'}</p>
              <p><strong>Estado:</strong> ${r.estado}</p>
              <p><strong>Fecha:</strong> ${new Date(r.fecha).toLocaleString()}</p>
            </div>
            <hr>
          `
        }).join('')

      } catch (err) {
        console.log('Error cargando reportes:', err)
        reportesList.innerHTML = '<p>Error cargando reportes.</p>'
      }
    }

    fetchReportes()
  </script>
</body>
</html>





